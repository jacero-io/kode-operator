graph TD
    A([Pending]) -->|Validation Passed| B([Configuring])
    A -->|Validation Failed| H([Failed])
    B -->|Resources Created| C([Provisioning])
    B -->|Error| H
    C -->|Resources Ready| D([Active])
    C -->|Error| H
    C -->|Resources Not Ready| C
    D -->|Resources Not Ready| B
    D -->|Inactivity Detected| E([Inactive])
    E -->|Suspension Initiated| F([Suspending])
    F -->|Suspension Complete| G([Suspended])
    G -->|Resume Initiated| I([Resuming])
    I -->|Resume Complete| B
    H -->|Retry| A
    H -->|Max Retries Exceeded| J([Manual Intervention Required])
    K([Unknown]) -->|State Determined| B
    L([Any State]) -->|Deletion Initiated| M([Deleting])
    N([Any State except Deleting]) -->|Generation Mismatch| B

    classDef state fill:#4CAF50,stroke:#333,stroke-width:2px,color:#fff;
    classDef special fill:#FFC107,stroke:#333,stroke-width:2px,color:#333;
    classDef reconcileOrigin fill:#FF4081,stroke:#333,stroke-width:2px,color:#fff;
    classDef initialState fill:#3F51B5,stroke:#333,stroke-width:4px,color:#fff;

    class A initialState;
    class B,C,D,E,F,G,H,I,J,K,M state;
    class L,N special;
    
    %% Reconcile event origins
    R1([New Kode Created]):::reconcileOrigin -->|Triggers| A
    R2([Spec Changed]):::reconcileOrigin -->|Triggers| N
    R3([Resource Status Changed]):::reconcileOrigin -->|Triggers| B
    R4([Periodic Reconciliation]):::reconcileOrigin -->|Triggers| D
    R5([Manual Action]):::reconcileOrigin -->|Triggers| G
    R5 -->|Triggers| J
    R6([Deletion Timestamp Set]):::reconcileOrigin -->|Triggers| L

    linkStyle 0,2,4,6,7,8,9,10,11,12,13,14 stroke:#2196F3,stroke-width:2px;
    linkStyle 1,3,5,15 stroke:#F44336,stroke-width:2px;
    linkStyle 16,17 stroke:#9C27B0,stroke-width:2px;
    linkStyle 18 stroke:#FF9800,stroke-width:2px;